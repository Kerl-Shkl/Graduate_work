\section{Принципы работы отладчика}
Отладчик~--- это программа, которая упрощает разработку программного
обеспечения, предоставляя разработчику способы поиска ошибок. Обычно функционал
отладчика предоставляет следующие возможности:
\begin{itemize}
  \item поставить точку останова. Например, пометить инструкцию, дойдя до
    которой, программа должна остановить свое выполнение и передать управление
    отладчику;
  \item трассировать программу. То есть, последовательно выполнять инструкции, и
    после каждой останавливать выполнение программы, и передавать управление
    отладчику;
  \item отобразить состояние регистров процессора на момент останова;
  \item отобразить состояние стека процесса на момент останова.
\end{itemize}

Возможности, предоставляемые отладчиком, могут быть использованы
злоумышленниками для изучения уязвимостей программного обеспечения, а также
обхода ограничений и защиты.  Для лучшего понимания способов защиты от отладчика
рассмотрим, как работает каждая предоставляемая им возможность более
подробно.

Отладчик может самостоятельно запустить отлаживаемый процесс. В рассматриваемой
системе Microsoft Windows для этого нужно вызвать функцию \verb!CreateProcess!
с указанием ей в качестве параметра \verb!fdwCreate! константы
\verb!DEBUG_PROCESS!. Также отладчик может подключиться к уже работающему
процессу. Для этого ему необходимо получить идентификатор процесса при помощи
функции \verb!OpenProcess!, после чего вызвать \verb!DebugActiveProcess! и, таким
образом, подключиться к нему.  Как правило, отладчик открывает процесс с доступом
на чтение и запись в виртуальную память процесса.

Затем отладчик в цикле обрабатывает события отладки, используя функцию
\verb!WaitForDebugEvent!. После завершения обработки очередного события отладки
вызывает функцию \verb!ContinueDebugEvent!. Общую схему работы отладчика можно
представить следующим образом:
\begin{verbatim}
  CreateProcess("FileName.exe", ..., DEBUG_PROCESS, ...); 
  for (;;) {
    WaitForDebugEvent(&dbgEv, INFINITE);
    switch(dbgEv.dwDebugEventCode) 
    {
    case EXCEPTION_DEBUG_EVENT:
    ...
    }
    ContinueDebugEvent( dbgEv.dwProcessId,
                        dbgEv.dwThreadId,
                        dwContinueStatus );
  }
\end{verbatim}

Перейдем к рассмотрению конкретных возможностей предоставляемых отладчиком.
